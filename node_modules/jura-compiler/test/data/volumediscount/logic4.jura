namespace org.accordproject.volumediscount

import org.accordproject.contract.*
import org.accordproject.late.*

define variable fee = 1.0
define function addFee(rate Double) : Double {
  match fee {
    with let v = 1.0 : rate + v/10.0
    with let v = 2.0 : rate + fee/15.0
    otherwise : rate
  }
}

contract VolumeDiscount over TemplateModel {
  // Clause for volume discount
  clause volumediscount(request VolumeDiscountRequest) : VolumeDiscountResponse {
    if request.netAnnualChargeVolume < contract.firstVolume {
	new VolumeDiscountResponse{ discountRate: addFee(contract.firstRate) }
    } else if request.netAnnualChargeVolume < contract.secondVolume {
	new VolumeDiscountResponse{ discountRate: addFee(contract.secondRate) }
    } else {
        new VolumeDiscountResponse{ discountRate: addFee(contract.thirdRate) }
    }
  }
}
